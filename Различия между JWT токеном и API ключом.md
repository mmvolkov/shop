## Различия между JWT токеном и API ключом

### JWT (JSON Web Token)

**Что это:**

- Самодостаточный токен, содержащий зашифрованную информацию о пользователе
- Состоит из трех частей: Header.Payload.Signature
- Может содержать claims (утверждения) о пользователе

**Характеристики:**

```java
// Пример JWT токена
eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyMSIsImlhdCI6MTcwMjQ1NjMyMCwiZXhwIjoxNzAyNTQyNzIwfQ.xKz5H9J8K_lX3vM2QzK8nL4P6hU3J8K9mN5Q2R4T6Y8

// Расшифровка Payload:
{
  "sub": "user1",           // subject (пользователь)
  "iat": 1702456320,       // issued at (время создания)
  "exp": 1702542720        // expiration (время истечения)
}
```

**Особенности:**

- **Временный** - имеет срок действия (в нашем случае 24 часа)
- **Stateless** - сервер не хранит токены
- **Безопасный** - подписан секретным ключом
- **Информативный** - содержит данные о пользователе

**Использование в нашем проекте:**

```java
// Генерация при входе
String token = jwtUtil.generateToken(user.getUsername());

// Передача в заголовке
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9...

// Проверка в фильтре
if (jwtUtil.validateToken(token, username)) {
    // Авторизация прошла
}
```

### API Key

**Что это:**

- Простая строка-идентификатор (обычно UUID)
- Постоянный ключ, привязанный к пользователю
- Хранится в базе данных

**Характеристики:**

```java
// Пример API ключа
550e8400-e29b-41d4-a716-446655440000
```

**Особенности:**

- **Постоянный** - не имеет срока действия
- **Stateful** - хранится в БД
- **Простой** - just a string
- **Быстрый** - простая проверка в БД

**Использование в нашем проекте:**

```java
// Генерация при регистрации
user.setApiKey(UUID.randomUUID().toString());

// Передача в заголовке
X-API-KEY: 550e8400-e29b-41d4-a716-446655440000

// Проверка в контроллере
User user = userRepository.findByApiKey(apiKey)
    .orElseThrow(() -> new RuntimeException("Invalid API key"));
```

## Сравнительная таблица

|Параметр|JWT Token|API Key|
|---|---|---|
|**Срок действия**|Временный (24 часа)|Постоянный|
|**Хранение на сервере**|Не хранится|Хранится в БД|
|**Содержимое**|Данные пользователя|Только идентификатор|
|**Размер**|~200-500 символов|~36 символов|
|**Производительность**|Быстрая проверка подписи|Запрос к БД|
|**Отзыв**|Сложно (нужен blacklist)|Просто (удалить из БД)|
|**Использование**|Для сессий пользователя|Для сервис-сервис|

## Почему в проекте используются оба?

### JWT для основных операций:

```java
@GetMapping("/api/items")
@PreAuthorize("hasRole('USER')")  // Проверка JWT
public List<Item> getAllItems() {
    // Обычные операции пользователя
}
```

**Преимущества:**

- Безопасные сессии с ограниченным сроком
- Не нагружает БД при каждом запросе
- Содержит роли и права пользователя

### API Key для критических операций:

```java
@PostMapping("/api/shipment")
public ResponseEntity<?> shipItem(@RequestHeader("X-API-KEY") String apiKey) {
    // Критическая операция - отгрузка товара
}
```

**Преимущества:**

- Дополнительный уровень защиты
- Легко отследить кто делал отгрузки
- Можно отозвать доступ мгновенно
- Подходит для интеграций с внешними системами

## Практический пример

```javascript
// 1. Вход - получаем оба ключа
POST /api/auth/login
Response: {
    "token": "eyJhbGci...",     // для обычных операций
    "apiKey": "550e8400..."      // для критических операций
}

// 2. Обычная операция - используем JWT
GET /api/items
Headers: {
    "Authorization": "Bearer eyJhbGci..."
}

// 3. Критическая операция - используем API Key
POST /api/shipment
Headers: {
    "X-API-KEY": "550e8400..."
}
```

## Рекомендации по безопасности

### Для JWT:

- Короткий срок жизни (1-24 часа)
- Использовать HTTPS
- Хранить в httpOnly cookies или localStorage
- Реализовать refresh tokens

### Для API Key:

- Генерировать криптографически стойкие ключи
- Никогда не передавать в URL
- Ограничивать по IP/домену
- Вести логи использования
- Возможность отзыва

Такой подход обеспечивает баланс между удобством (JWT для повседневных операций) и безопасностью (API Key для критических действий).